<!DOCTYPE html>
<html>

<head>
  <title>AR.js QR Code Scanner with Models</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    .round-button {
      border: none;
      border-radius: 50%;
      background-color: transparent;
      color: white;
      cursor: pointer;
      transition: transform 0.1s, background-color 0.3s;
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }

    .round-button:active {
      transform: scale(0.9);
    }

    .round-button:focus {
      outline: none;
    }

    .button-container {
      position: absolute;
      top: 10px;
      right: 5px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
  </style>

  <script>
    let entity;

    const icon = () => document.getElementById('audio-icon');

    const isNotMute = () => icon().src.includes('SoundOn.png');

    const audioHandler = () => {
      if (isNotMute()) {
        icon().src = 'static/SoundOff.png';
        entity && entity.components.sound.pauseSound();
      } else {
        icon().src = 'static/SoundOn.png';
        entity && entity.components.sound.playSound();
      }
    };

    AFRAME.registerComponent('markerhandler', {
      init: function () {
        this.el.addEventListener('markerFound', () => {
          entity = this.el.querySelector('a-entity');
          isNotMute() && entity.components.sound.playSound();
        });

        this.el.addEventListener('markerLost', () => {
          entity = this.el.querySelector('a-entity');
          entity.components.sound.stopSound();
        });
      }
    });
  </script>
</head>

<body style="margin: 0; overflow: hidden;">

  <a-scene embedded
    arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960;'
    xr-mode-ui="enabled: false" id="scene" renderer='logarithmicDepthBuffer: true;'>
    <a-marker id="ar-model" type="pattern" preset="custom" url="./pattern-wireless-card.patt" smooth="true"
      smoothCount="10" smoothTolerance="0.005" smoothThreshold="1" markerhandler>
      <a-entity obj-model="obj: url(resources/combined_wireless.obj); mtl: url(resources/combined_wireless.mtl)"
        sound="src: url(resources/VO_Wireless.mp3); autoplay: false; distanceModel: linear; rolloffFactor: 0; maxDistance: 10000"
        scale="0.2 0.2 0.2">
      </a-entity>
    </a-marker>
    <!-- Lighting -->
    <a-light type="directional" position="2 4 10" intensity="1"></a-light>
    <a-entity camera></a-entity>
  </a-scene>

  <div class="button-container">
    <button id="pause-audio" class="round-button" onclick="audioHandler()"><img id="audio-icon" src="static/SoundOn.png"
        alt="pause audio" width="48px" height="auto"></button>
  </div>

</body>

</html>